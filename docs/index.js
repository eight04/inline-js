!function(){var e={props:{id:Number,name:String,type:String,data:String},data(){return{editorName:this.name,editorType:this.type,textData:"text"===this.type?this.data:"",binaryData:"binary"===this.type?this.data:"",readingFile:!1}},mounted(){for(const[e,t]of[["editorName","name"],["editorType","type"]])this.$watch(e,()=>{this.$emit("file-update",{prop:t,data:this[e]}),"editorType"===e&&this.$emit("file-update",{prop:"data",data:"text"===this.editorType?this.textData:this.binaryData})});for(const e of["textData","binaryData"])this.$watch(e,()=>{"text"===this.type?this.$emit("file-update",{prop:"data",data:this.textData}):"binary"===this.type&&this.$emit("file-update",{prop:"data",data:this.binaryData})})},computed:{binaryDataStatus(){return this.readingFile?"Reading the file...":this.binaryData?this.fileType:"Drop your file here"},fileType(){if(!this.binaryData)return"no data";const e=this.binaryData.match(/^data:(.*?)[,;]/);return e&&e[1]?e[1]:"unknown type"}},methods:{drop(e){e.preventDefault();const t=e.dataTransfer.files[0];t&&(this.readingFile=!0,function(e){return new Promise((t,i)=>{const a=new FileReader;a.onload=e=>{t(e.target.result)},a.onerror=i,a.readAsDataURL(e)})}(t).then(e=>{this.readingFile=!1,this.binaryData=e}))},dragover(e){e.preventDefault()}}};const t={class:"file-editor"},i={class:"editor-type"},a={class:"editor-content"},o=["src"];function l(){let e,t=0;const i=new Map;return{compile:function(l){e||(e=new Worker("worker.js"),e.addEventListener("error",a),e.addEventListener("message",o));return new Promise((a,o)=>{const r=t++;e.postMessage({requestId:r,files:Vue.toRaw(l)}),i.set(r,{resolve:a,reject:o})})}};function a(e){for(const{reject:t}of i.values())t(e);i.clear()}function o(e){e.data.error?i.get(e.data.requestId).reject(e.data.data):i.get(e.data.requestId).resolve(e.data.data),i.delete(e.data.requestId)}}e.render=function(e,l,r,n,s,d){return Vue.openBlock(),Vue.createElementBlock("div",t,[Vue.withDirectives(Vue.createElementVNode("input",{type:"text",class:"file-name","onUpdate:modelValue":l[0]||(l[0]=e=>s.editorName=e)},null,512),[[Vue.vModelText,s.editorName]]),Vue.createElementVNode("button",{type:"button",onClick:l[1]||(l[1]=t=>e.$emit("delete-file"))},"Remove"),Vue.createElementVNode("div",i,[Vue.createElementVNode("label",null,[Vue.withDirectives(Vue.createElementVNode("input",{type:"radio",value:"text","onUpdate:modelValue":l[2]||(l[2]=e=>s.editorType=e)},null,512),[[Vue.vModelRadio,s.editorType]]),l[7]||(l[7]=Vue.createTextVNode(" Text ",-1))]),Vue.createElementVNode("label",null,[Vue.withDirectives(Vue.createElementVNode("input",{type:"radio",value:"binary","onUpdate:modelValue":l[3]||(l[3]=e=>s.editorType=e)},null,512),[[Vue.vModelRadio,s.editorType]]),l[8]||(l[8]=Vue.createTextVNode(" Binary ",-1))])]),Vue.createElementVNode("div",a,[Vue.withDirectives(Vue.createElementVNode("textarea",{class:"text-data","onUpdate:modelValue":l[4]||(l[4]=e=>s.textData=e)},null,512),[[Vue.vShow,"text"===r.type],[Vue.vModelText,s.textData]]),Vue.withDirectives(Vue.createElementVNode("div",{class:"binary-data",onDrop:l[5]||(l[5]=(...e)=>d.drop&&d.drop(...e)),onDragover:l[6]||(l[6]=(...e)=>d.dragover&&d.dragover(...e))},[Vue.createTextVNode(Vue.toDisplayString(d.binaryDataStatus)+" ",1),d.fileType.startsWith("image")?(Vue.openBlock(),Vue.createElementBlock("img",{key:0,src:s.binaryData},null,8,o)):Vue.createCommentVNode("v-if",!0)],544),[[Vue.vShow,"binary"===r.type]])])])},e.__file="src/FileEditor.vue";var r={data:()=>({files:[],id:0,compileResult:null,compileError:null,compiling:null,compileNext:null,worker:l()}),mounted(){let e,t=!1;try{const t=document.location.hash.slice(2);e=JSON.parse(atob(t))}catch(i){e=[{type:"text",name:"entry",data:"$inline('foo.txt') $inline('bar.txt')!"},{type:"text",name:"foo.txt",data:"Hello"},{type:"text",name:"bar.txt",data:"inline-js"}],t=!0}for(const t of e)this.addFile(t);t&&this.updateURL(),this.compile()},methods:{updateFile(e,t){e[t.prop]=t.data,this.updateURL(),this.compile()},updateURL(){const e=this.files.map(e=>{const t=Object.assign({},e);return delete t.id,t}),t=btoa(JSON.stringify(e));history.replaceState({},"",`#!${t}`)},getNewName(){const e=new Set(this.files.map(e=>e.name));let t="file",i=1;for(;e.has(t);)t="file"+i++;return t},addFile({name:e=this.getNewName(),data:t="",type:i="text"}={}){this.files.push({id:this.id++,name:e,type:i,data:t})},deleteFile(e){const t=this.files.indexOf(e);this.files.splice(t,1)},compile(){const e=e=>{this.compiling=null,this.compileResult=e,this.compileError=null},t=e=>{this.compiling=null,this.compileResult=null,this.compileError=e,console.error(e)};this.compiling?this.compileNext||(this.compileNext=this.compiling.then(()=>(this.compiling=this.compileNext,this.compileNext=null,this.worker.compile(this.files))).then(e,t)):this.compiling=this.worker.compile(this.files).then(e,t)}},components:{FileEditor:e}};const n={id:"app"},s={class:"file-system"},d={class:"inliner"},c={key:0,class:"compile-error"},u={key:1,class:"compile-success"};r.render=function(e,t,i,a,o,l){const r=Vue.resolveComponent("FileEditor");return Vue.openBlock(),Vue.createElementBlock("div",n,[Vue.createElementVNode("div",s,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(o.files,e=>(Vue.openBlock(),Vue.createBlock(r,Vue.mergeProps({key:e.id},{ref_for:!0},e,{onFileUpdate:t=>l.updateFile(e,t),onDeleteFile:t=>l.deleteFile(e)}),null,16,["onFileUpdate","onDeleteFile"]))),128)),Vue.createElementVNode("button",{onClick:t[0]||(t[0]=e=>l.addFile()),type:"button"},"Add file")]),Vue.createElementVNode("div",d,[o.compileError?(Vue.openBlock(),Vue.createElementBlock("div",c,Vue.toDisplayString(o.compileError),1)):o.compileResult?(Vue.openBlock(),Vue.createElementBlock("div",u,[Vue.createTextVNode(" Compiled in "+Vue.toDisplayString(o.compileResult.timeout)+"ms. Dependency tree: ",1),Vue.createElementVNode("pre",null,Vue.toDisplayString(o.compileResult.dependency),1)])):Vue.createCommentVNode("v-if",!0),o.compileResult?Vue.withDirectives((Vue.openBlock(),Vue.createElementBlock("textarea",{key:2,class:"compile-result",readonly:"","onUpdate:modelValue":t[1]||(t[1]=e=>o.compileResult.content=e)},null,512)),[[Vue.vModelText,o.compileResult.content]]):Vue.createCommentVNode("v-if",!0)])])},r.__file="src/App.vue",Vue.createApp(r).mount("#app")}();
