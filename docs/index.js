(()=>{const e={props:{id:Number,name:String,type:String,data:String},data(){return{editorName:this.name,editorType:this.type,textData:"text"===this.type?this.data:"",binaryData:"binary"===this.type?this.data:"",readingFile:!1}},mounted(){for(const[e,t]of[["editorName","name"],["editorType","type"]])this.$watch(e,()=>{this.$emit("file-update",{prop:t,data:this[e]}),"editorType"===e&&this.$emit("file-update",{prop:"data",data:"text"===this.editorType?this.textData:this.binaryData})});for(const e of["textData","binaryData"])this.$watch(e,()=>{"text"===this.type?this.$emit("file-update",{prop:"data",data:this.textData}):"binary"===this.type&&this.$emit("file-update",{prop:"data",data:this.binaryData})})},computed:{binaryDataStatus(){return this.readingFile?"Reading the file...":this.binaryData?this.fileType:"Drop your file here"},fileType(){if(!this.binaryData)return"no data";const e=this.binaryData.match(/^data:(.*?)[,;]/);return e&&e[1]?e[1]:"unknown type"}},methods:{drop(e){e.preventDefault();const t=e.dataTransfer.files[0];t&&(this.readingFile=!0,function(e){return new Promise((t,i)=>{const a=new FileReader;a.onload=(e=>{t(e.target.result)}),a.onerror=i,a.readAsDataURL(e)})}(t).then(e=>{this.readingFile=!1,this.binaryData=e}))},dragover(e){e.preventDefault()}}};var t=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"file-editor"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.editorName,expression:"editorName"}],staticClass:"file-name",attrs:{type:"text"},domProps:{value:e.editorName},on:{input:function(t){t.target.composing||(e.editorName=t.target.value)}}}),e._v(" "),i("button",{attrs:{type:"button"},on:{click:function(t){e.$emit("delete-file")}}},[e._v("Remove")]),e._v(" "),i("div",{staticClass:"editor-type"},[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.editorType,expression:"editorType"}],attrs:{type:"radio",value:"text"},domProps:{checked:e._q(e.editorType,"text")},on:{change:function(t){e.editorType="text"}}}),e._v("\n      Text\n    ")]),e._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.editorType,expression:"editorType"}],attrs:{type:"radio",value:"binary"},domProps:{checked:e._q(e.editorType,"binary")},on:{change:function(t){e.editorType="binary"}}}),e._v("\n      Binary\n    ")])]),e._v(" "),i("div",{staticClass:"editor-content"},[i("textarea",{directives:[{name:"show",rawName:"v-show",value:"text"===e.type,expression:"type === 'text'"},{name:"model",rawName:"v-model",value:e.textData,expression:"textData"}],staticClass:"text-data",domProps:{value:e.textData},on:{input:function(t){t.target.composing||(e.textData=t.target.value)}}}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"binary"===e.type,expression:"type === 'binary'"}],staticClass:"binary-data",on:{drop:e.drop,dragover:e.dragover}},[e._v("\n      "+e._s(e.binaryDataStatus)+"\n      "),e.fileType.startsWith("image")?i("img",{attrs:{src:e.binaryData}}):e._e()])])])};t._withStripped=!0;const i={data:()=>({files:[],id:0,compileResult:null,compileError:null,compiling:null,compileNext:null,worker:function(){let e,t=0;const i=new Map;return{compile:function(r){return e||((e=new Worker("worker.js")).addEventListener("error",a),e.addEventListener("message",n)),new Promise((a,n)=>{const s=t++;e.postMessage({requestId:s,files:r}),i.set(s,{resolve:a,reject:n})})}};function a(e){for(const{reject:t}of i.values())t(e);i.clear()}function n(e){e.data.error?i.get(e.data.requestId).reject(e.data.data):i.get(e.data.requestId).resolve(e.data.data),i.delete(e.data.requestId)}}()}),mounted(){let e,t=!1;try{const i=document.location.hash.slice(2);e=JSON.parse(atob(i))}catch(i){e=[{type:"text",name:"entry",data:"$inline('foo.txt') $inline('bar.txt')!"},{type:"text",name:"foo.txt",data:"Hello"},{type:"text",name:"bar.txt",data:"inline-js"}],t=!0}for(const t of e)this.addFile(t);t&&this.updateURL(),this.compile()},methods:{updateFile(e,t){e[t.prop]=t.data,this.updateURL(),this.compile()},updateURL(){const e=this.files.map(e=>{const t=Object.assign({},e);return delete t.id,t}),t=btoa(JSON.stringify(e));history.replaceState({},"",`#!${t}`)},getNewName(){const e=new Set(this.files.map(e=>e.name));let t="file",i=1;for(;e.has(t);)t="file"+i++;return t},addFile({name:e=this.getNewName(),data:t="",type:i="text"}={}){this.files.push({id:this.id++,name:e,type:i,data:t})},deleteFile(e){const t=this.files.indexOf(e);this.files.splice(t,1)},compile(){const e=e=>{this.compiling=null,this.compileResult=e,this.compileError=null},t=e=>{this.compiling=null,this.compileResult=null,this.compileError=e};this.compiling?this.compileNext||(this.compileNext=this.compiling.then(()=>(this.compiling=this.compileNext,this.compileNext=null,this.worker.compile(this.files))).then(e,t)):this.compiling=this.worker.compile(this.files).then(e,t)}},components:{FileEditor:function(e,t,i,a,n,r,s,o){const l=("function"==typeof i?i.options:i)||{};return l.__file="D:\\Dev\\inline-js\\src\\FileEditor.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,n&&(l.functional=!0)),l._scopeId=a,l}({render:t,staticRenderFns:[]},0,e,void 0,!1)}};var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("div",{staticClass:"file-system"},[e._l(e.files,function(t){return i("FileEditor",e._b({key:t.id,on:{"file-update":function(i){e.updateFile(t,i)},"delete-file":function(i){e.deleteFile(t)}}},"FileEditor",t,!1))}),e._v(" "),i("button",{attrs:{type:"button"},on:{click:function(t){e.addFile()}}},[e._v("Add file")])],2),e._v(" "),i("div",{staticClass:"inliner"},[e.compileError?i("div",{staticClass:"compile-error"},[e._v(e._s(e.compileError))]):e.compileResult?i("div",{staticClass:"compile-success"},[e._v("\n      Compiled in "+e._s(e.compileResult.timeout)+"ms.\n      \n      Dependency tree:\n      "),i("pre",[e._v(e._s(e.compileResult.dependency))])]):e._e(),e._v(" "),e.compileResult?i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.compileResult.content,expression:"compileResult.content"}],staticClass:"compile-result",attrs:{readonly:""},domProps:{value:e.compileResult.content},on:{input:function(t){t.target.composing||e.$set(e.compileResult,"content",t.target.value)}}}):e._e()])])};a._withStripped=!0;var n=function(e,t,i,a,n,r,s,o){const l=("function"==typeof i?i.options:i)||{};return l.__file="D:\\Dev\\inline-js\\src\\App.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,n&&(l.functional=!0)),l._scopeId=a,l}({render:a,staticRenderFns:[]},0,i,void 0,!1);new Vue({el:"#app",render:e=>e(n)})})();
